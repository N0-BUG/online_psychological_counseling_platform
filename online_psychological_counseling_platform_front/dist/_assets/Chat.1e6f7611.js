let e=document.createElement("style");e.innerHTML=".tip{color:#fff;text-align:center;border-radius:10px;font-family:sans-serif;padding:10px;width:auto;display:inline-block!important}.right{background-color:#00bfff}.left{background-color:#228b22}",document.head.appendChild(e);import{s as t,r as a,l,f as s,a as o,o as n,c as i,b as r,e as c,w as d,F as p,n as u,v as g,m as v,d as h,x as m,t as x,L as y,M as f,E as b,A as k,g as w}from"./index.5272c697.js";const S={style:{"background-color":"#cce5F3","background-size":"100%",height:"100%",width:"100%"}},C={style:{padding:"10px"}},_=r("div",{style:{"padding-bottom":"10px","border-bottom":"1px solid #ccc"}},[h(" 联系人"),r("span",{style:{"font-size":"12px"}},"（点击聊天气泡开始聊天）")],-1),z=["onClick"],W={key:0,style:{"font-size":"15px",color:"limegreen","margin-left":"5px"}},U={style:{width:"900px","background-color":"white","border-radius":"5px","box-shadow":"0 0 10px #ccc",margin:"0 auto 0 5px"}},T={style:{"text-align":"center","line-height":"50px"}},$=["innerHTML"],L={style:{height:"200px"}},M={style:{"text-align":"right","padding-right":"10px"}};var j={__name:"Chat",setup(e){const j=t().params.isConsultant,H=a({}),J=a([]),N=a(""),O=a(""),R=a([]),B=a(""),E=a("");let F;const A=()=>{if(N.value)if(O.value)if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");const e={from:H.value.username,to:N.value,text:O.value,avatarUrl:E.value};F.send(JSON.stringify(e)),R.value.push({user:H.value.username,text:O.value,avatarUrl:E.value}),D(null,H.value.username,O.value,E.value),O.value=""}else b({type:"warning",message:"请输入内容"});else b({type:"warning",message:"请选择聊天对象"})},D=(e,t,a,l)=>{let s="";t?s=`\n      <div class="el-row" style="padding: 5px 0">\n        <div class="el-col el-col-22" style="text-align: right; padding-right: 5px">\n          <div class="tip left">${a}</div>\n        </div>\n        <div class="el-col el-col-2">\n          <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n            <img src="${l}" style="object-fit: cover;">\n          </span>\n        </div>\n      </div>\n    `:e&&(s=`\n      <div class="el-row" style="padding: 5px 0">\n        <div class="el-col el-col-2" style="text-align: right">\n           <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n            <img src="${l}" style="object-fit: cover;">\n          </span>\n        </div>\n        <div class="el-col el-col-22" style="text-align: left; padding-left: 5px">\n          <div class="tip right">${a}</div>\n        </div>\n      </div>\n    `),B.value+=s};H.value=JSON.parse(sessionStorage.getItem("user")||"{}");const I=t().params.reservationUser,P=t().params.reservationConsultant,V=()=>{k.confirm("确定要结束该预约吗?","警告",{confirmButtonText:"是的",cancelButtonText:"取消",type:"warning"}).then((()=>{(async()=>{try{200===(await s.post("http://localhost:8091/reservation/overRes",{reservationUser:I,reservationConsultant:P})).data.code?(b({type:"success",message:"操作成功"}),await w.push({name:"consultantRes"})):b({type:"error",message:"操作失败"})}catch(e){b({type:"error",message:"操作失败"})}})()})).catch((()=>{b({type:"info",message:"放弃操作"})}))};return l((async()=>{try{const e=await s.get("http://localhost:8091/user/chatPfp",{params:{username:H.value.username}});200==e.data.code&&(E.value=e.data.data)}catch(e){console.log("请求失败")}(()=>{const e=H.value.username;if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");const t=`ws://localhost:8091/chat/${e}`;F&&(F.close(),F=null),F=new WebSocket(t),F.onopen=()=>{console.log("websocket已打开")},F.onmessage=t=>{console.log("收到数据===="+t.data);const a=JSON.parse(t.data);a.users?J.value=a.users.filter((t=>t.username!==e)):a.from===N.value&&(R.value.push(a),D(a.from,null,a.text,a.avatarUrl))},F.onclose=()=>{console.log("websocket已关闭")},F.onerror=()=>{console.log("websocket发生了错误")}}})()})),(e,t)=>{const a=o("ChatDotRound"),l=o("el-icon"),s=o("el-card"),b=o("el-button"),k=o("el-col"),w=o("el-row");return n(),i("div",S,[r("div",C,[c(w,null,{default:d((()=>[c(k,{span:6,style:{"background-color":"whitesmoke"}},{default:d((()=>[c(s,{style:{width:"100%","min-height":"300px",color:"#333"}},{default:d((()=>[_,(n(!0),i(p,null,u(J.value,(e=>(n(),i("div",{key:e.username,style:{padding:"10px 0"}},[r("span",null,x(e.username),1),r("i",{style:{"margin-left":"10px","font-size":"16px",cursor:"pointer"},onClick:t=>N.value=e.username},[c(l,null,{default:d((()=>[c(a)])),_:1})],8,z),e.username===N.value?(n(),i("span",W,"联系中...")):m("",!0)])))),128))])),_:1}),"yes"===g(j)?(n(),v(b,{key:0,style:{"margin-left":"150px","margin-top":"40px","font-size":"17px"},size:"large",type:"primary",onClick:V},{default:d((()=>[h(" 咨询结束 ")])),_:1})):m("",!0)])),_:1}),c(k,{span:18,style:{"background-color":"whitesmoke"}},{default:d((()=>[r("div",U,[r("div",T," 在线心理咨询室("+x(N.value)+") ",1),r("div",{style:{height:"350px",overflow:"auto","border-top":"1px solid #ccc"},innerHTML:B.value},null,8,$),r("div",L,[y(r("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>O.value=e),style:{height:"160px",width:"860px",padding:"20px",border:"none","border-top":"1px solid #ccc","border-bottom":"1px solid #ccc",outline:"none"}},null,512),[[f,O.value]]),r("div",M,[c(b,{size:"mini",type:"primary",onClick:A},{default:d((()=>[h("发送")])),_:1})])])])])),_:1})])),_:1})])])}}};export{j as default};
